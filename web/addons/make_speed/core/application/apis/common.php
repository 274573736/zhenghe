<?php
 use app\common\model\Category; use fast\Form; use fast\Tree; use think\Db; goto G7b1C; e_iU_: function getScopeRider($order_id, $type = 0) { goto NK3i6; eypxT: $where["\165\156\151\x61\x63\151\x64"] = $GLOBALS["\x75\x6e\x69\x61\x63\x69\x64"]; goto pUGZV; NK3i6: $address = Db::name("\157\162\144\145\162\x5f\141\x64\144\x72\145\163\x73")->where(array("\157\x72\144\x65\162\137\x69\144" => $order_id))->find(); goto DONFR; F4DXG: $where["\151\163\137\141\143\x63\x65\x70\164"] = 1; goto eypxT; BipU4: $distance = Db::name("\x73\145\164\164\151\156\147")->where(array("\x6b\x65\171" => "\162\151\x64\x65\x72\137\x64\x69\163\x74\141\x6e\143\x65", "\x75\x6e\x69\x61\x63\151\x64" => $GLOBALS["\x75\x6e\151\x61\x63\x69\x64"]))->find(); goto kx4n1; YOFZK: return array(); goto A3sUh; Xtfrx: if (!empty($rider)) { goto d7K_H; } goto nbViT; pUGZV: $rider = Db::name("\162\151\x64\x65\162\137\x69\156\146\157")->where($where)->where("\x6c\x61\164", ["\76\75", $scope["\155\x69\156\x6c\141\164"]], ["\x3c\75", $scope["\155\x61\x78\154\141\164"]], "\141\x6e\144")->where("\x6c\x6e\x67", ["\76\75", $scope["\155\151\x6e\154\x6e\x67"]], ["\x3c\x3d", $scope["\155\141\x78\154\x6e\147"]], "\141\156\144")->column("\162\151\x64\145\x72\137\151\x64\54\x6c\x61\164\x2c\x6c\x6e\147"); goto Xtfrx; DONFR: if (!empty($address)) { goto naMH1; } goto YOFZK; hXdRm: $scope = getPointDistance($address["\142\145\x67\151\x6e\137\154\156\147"], $address["\142\x65\x67\x69\x6e\137\154\141\164"], $distance["\166\x61\154\x75\x65"] * 2); goto F4DXG; w5v5v: return $rider; goto EA5Cn; cN8j7: d7K_H: goto w5v5v; nbViT: return array(); goto cN8j7; A3sUh: naMH1: goto BipU4; kx4n1: $distance["\x76\141\x6c\x75\x65"] = !empty($distance["\166\141\x6c\165\145"]) ? intval($distance["\x76\x61\x6c\165\x65"]) : 10; goto hXdRm; EA5Cn: } goto VB5lZ; AGo0q: function addRiderMessage($rider_id, $type, $title, $content = '', $object_id = 0, $is_all = 0) { goto Terh8; UxaGu: return false; goto nVxyp; KMLYE: return true; goto AZS_2; dFRjw: if (empty($add)) { goto pyyjD; } goto KMLYE; AZS_2: pyyjD: goto UxaGu; EYV5X: $add = Db::name("\162\x69\x64\145\x72\x5f\x6d\x65\163\x73\x61\147\x65")->insert($data); goto dFRjw; Terh8: $data = array("\x72\151\x64\145\x72\137\x69\x64" => intval($rider_id), "\x74\x79\160\145" => intval($type), "\x74\x69\x74\154\145" => trim($title), "\x63\x6f\156\164\145\156\164" => $content, "\157\142\152\145\x63\x74\137\151\144" => intval($object_id), "\141\x6c\x6c" => intval($is_all), "\141\x64\x64\x5f\164\x69\155\x65" => time(), "\165\156\x69\141\x63\151\x64" => $GLOBALS["\x75\x6e\151\x61\x63\151\144"]); goto EYV5X; nVxyp: } goto r5skg; Qdo3_: function send_aliyun_sms($mobile, $codeParam, $templateCode = "\141\x6c\151\137\x74\145\x6d\x70\137\x63\157\x64\145") { goto HzgOR; A9lQk: $params["\124\145\x6d\x70\x6c\x61\x74\x65\103\x6f\144\x65"] = $smsparam[$templateCode]; goto HStuO; HhDDw: $params["\x53\x69\147\156\116\x61\x6d\x65"] = $smsparam["\141\154\151\x5f\163\x69\x67\156\137\x6e\141\155\x65"]; goto A9lQk; rSFby: $params = array(); goto Zh0fu; CYtVa: $params["\124\x65\x6d\x70\x6c\141\x74\145\x50\141\162\x61\155"] = $codeParam; goto hMe9u; Lnwt6: return !empty($result) ? json_decode($result, true) : array(); goto ee4Dc; rGslf: d7KkP: goto zaw5j; PlC8u: $params["\124\145\155\160\x6c\x61\164\x65\120\141\x72\x61\x6d"] = json_encode($params["\x54\145\155\160\154\x61\164\145\120\141\162\141\155"], JSON_UNESCAPED_UNICODE); goto rGslf; sGw_D: $result = $helper->request($keyId, $keySecret, $params); goto Lnwt6; Sikfj: $keyId = $smsparam["\x61\x6c\x69\137\x73\155\163\x5f\x61\160\x70\151\x64"]; goto VZVF7; HStuO: $params["\x50\150\x6f\x6e\x65\116\165\155\x62\x65\x72\163"] = $mobile; goto CYtVa; usEXe: return false; goto envC7; ZCpA0: $smsparam = Db::name("\x73\145\164\x74\151\156\x67")->where($where)->where("\153\145\171", "\151\156", "\x61\154\151\137\x73\155\163\x5f\x61\x70\160\x69\144\x2c\x61\154\151\137\163\155\163\x5f\163\145\x63\162\145\x74\x2c\141\x6c\151\137\163\151\x67\x6e\x5f\156\141\155\x65\54" . $templateCode)->column("\153\145\x79\54\x76\x61\154\x75\x65"); goto Sikfj; envC7: PeAW0: goto rSFby; hMe9u: if (!(!empty($params["\124\145\155\x70\x6c\x61\164\145\x50\141\x72\141\155"]) && is_array($params["\x54\x65\155\x70\x6c\141\164\x65\x50\x61\162\x61\155"]))) { goto d7KkP; } goto PlC8u; HzgOR: if (!empty($mobile)) { goto PeAW0; } goto usEXe; VZVF7: $keySecret = $smsparam["\x61\x6c\x69\x5f\x73\x6d\163\x5f\163\145\x63\x72\x65\164"]; goto HhDDw; Zh0fu: $where = array("\x75\156\151\x61\143\x69\x64" => $GLOBALS["\165\156\151\x61\x63\151\x64"]); goto ZCpA0; zaw5j: vendor("\x41\154\x69\171\x75\x6e\x2e\x53\151\x67\156\141\x74\165\162\x65\x48\x65\154\160\145\162"); goto ore7b; ore7b: $helper = new \SignatureHelper(); goto sGw_D; ee4Dc: } goto jhmPq; xlVwF: function get_access_token($uniacid = 0) { goto zx3Fg; sSDD3: $tokenUrl = "\x68\x74\x74\x70\x73\72\57\57\x61\160\151\56\x77\145\151\170\x69\x6e\x2e\x71\161\x2e\143\157\x6d\57\x63\147\151\55\x62\151\156\57\x74\157\x6b\145\156\x3f\147\162\x61\156\164\x5f\x74\x79\x70\145\x3d\x63\x6c\151\x65\156\x74\x5f\x63\162\145\x64\x65\x6e\x74\151\x61\x6c\46\141\160\x70\151\x64\75" . $uni["\x6b\145\171"] . "\46\163\x65\143\162\145\x74\x3d" . $uni["\163\x65\x63\x72\x65\x74"]; goto xw880; qvRTB: KW9c6: goto sSDD3; stV45: $uni = Db::table($tablepre . "\141\143\143\x6f\165\x6e\x74\x5f\167\170\x61\160\x70")->where(array("\x75\x6e\151\141\x63\151\144" => $uniacid))->field("\x6b\x65\171\x2c\x73\x65\x63\162\145\x74")->find(); goto Y2Orx; Y2Orx: if (!empty($uni)) { goto KW9c6; } goto oEK1y; xw880: $html = file_get_contents($tokenUrl); goto JcOrm; VkFlo: $tablepre = !empty($_W["\x63\x6f\x6e\x66\x69\147"]["\x64\142"]["\164\141\x62\x6c\145\160\162\145"]) ? $_W["\143\157\x6e\x66\151\x67"]["\x64\142"]["\x74\141\x62\154\x65\160\162\145"] : "\x69\x6d\163\x5f"; goto stV45; JcOrm: $arr = json_decode($html, true); goto WuqGY; zx3Fg: global $_W; goto pAynK; WuqGY: return !empty($arr["\141\143\x63\145\163\163\x5f\x74\x6f\153\x65\156"]) ? $arr["\141\143\143\145\163\163\x5f\164\157\153\x65\x6e"] : $arr; goto EJU_l; oEK1y: return false; goto qvRTB; pAynK: $uniacid = !empty($uniacid) ? intval($uniacid) : $GLOBALS["\x75\x6e\151\x61\143\x69\144"]; goto VkFlo; EJU_l: } goto AvMsG; kWOLr: function getRandChar($length) { goto seEYp; Ts0V1: $strPol = "\x61\x62\x63\144\x65\x66\147\x68\x69\x6a\x6b\154\155\x6e\x6f\x70\x71\162\163\164\x75\x76\167\170\x79\x7a\x30\61\62\63\64\65\66\67\x38\71\101\102\103\104\x45\x46\107\x48\x49\112\113\114\115\x4e\117\x50\x51\122\123\124\125\126\x57\x58\x59\132"; goto MAFXv; OvVLA: $i++; goto uz3dj; vWcs5: if (!($i < $length)) { goto gmCdU; } goto kL18w; RCtfa: gmCdU: goto etPPt; uz3dj: goto dd8N6; goto RCtfa; dh91D: $i = 0; goto Ylrmt; iiizz: LHXlC: goto OvVLA; MAFXv: $max = strlen($strPol) - 1; goto dh91D; kL18w: $str .= $strPol[rand(0, $max)]; goto iiizz; seEYp: $str = null; goto Ts0V1; Ylrmt: dd8N6: goto vWcs5; etPPt: return $str; goto YavD5; YavD5: } goto rRhdQ; G7b1C: function msg($data = '', $errCode = 0, $msg = "\163\x75\x63\143\145\x73\x73") { return ["\x65\x72\162\157\162\x5f\143\157\144\145" => $errCode, "\155\x73\147" => $msg, "\144\141\x74\x61" => $data]; } goto kWOLr; AvMsG: function generate_order_code($length = 16, $pre = '', $exists = false) { goto JtSLn; gZjNh: $order .= mt_rand(0, 9); goto xPRY9; RD9Fk: vF6UH: goto oNbB5; EiCA8: lvbJD: goto BQku6; sLrbr: goto lvbJD; goto rm7pg; JtSLn: $order = $pre . date("\x59\155\144"); goto IJ7Mu; L99KC: $i++; goto sLrbr; XYFOC: if (empty($result)) { goto vF6UH; } goto sCQVg; sCQVg: return generate_order_code($length, $pre, $exists); goto RD9Fk; kVhDi: $result = Db::name("\157\x72\x64\145\x72")->where(array("\x6f\x72\144\145\162\x5f\143\x6f\x64\x65" => $order))->find(); goto XYFOC; TBxBC: if (empty($exists)) { goto IW56L; } goto kVhDi; ESO3I: return $order; goto X4OYq; xPRY9: MoOUt: goto L99KC; IJ7Mu: $rand_length = $length - strlen($order); goto LWWBh; rm7pg: I9cIf: goto TBxBC; oNbB5: IW56L: goto ESO3I; BQku6: if (!($i < $rand_length)) { goto I9cIf; } goto gZjNh; LWWBh: $i = 0; goto EiCA8; X4OYq: } goto j7Lwe; EJOXd: function get_point_distance($from, $to) { goto vyxB2; VZKE6: $result = setRequest($url); goto S4euU; WZJ_J: return $result["\162\145\163\x75\154\164"]["\145\x6c\145\x6d\x65\156\x74\x73"]; goto hWBY8; X0FMR: return array(); goto bKfKp; bKfKp: f6CwT: goto WZJ_J; S4euU: $result = json_decode($result, true); goto UoWpW; UoWpW: if (!(empty($result) || $result["\x73\x74\141\x74\165\163"] !== 0 || empty($result["\x72\x65\163\165\x6c\x74"]["\x65\x6c\145\x6d\145\x6e\164\163"]))) { goto f6CwT; } goto X0FMR; lxOV1: $url .= "\46\x66\162\x6f\x6d\75" . $from . "\x26\x74\157\x3d" . $to; goto VZKE6; VWW3e: $key = !empty($setting["\166\x61\x6c\x75\x65"]) ? $setting["\x76\141\x6c\165\145"] : "\131\x34\123\x42\x5a\x2d\130\107\67\66\127\x2d\105\115\117\122\117\x2d\122\x46\112\x36\x48\55\112\62\127\x4e\126\x2d\x4f\x4e\102\113\123"; goto f3P1q; vyxB2: $setting = Db::name("\x73\145\x74\x74\151\x6e\x67")->where(array("\x75\156\151\141\143\x69\144" => $GLOBALS["\165\156\x69\141\x63\151\x64"], "\x6b\x65\171" => "\x74\145\x6e\143\x65\156\x74\x5f\153\145\x79"))->field("\x76\x61\x6c\165\145")->find(); goto VWW3e; f3P1q: $url = "\x68\164\164\160\163\x3a\x2f\57\141\160\151\163\56\155\141\160\x2e\x71\161\x2e\143\157\x6d\x2f\x77\163\x2f\x64\x69\x73\x74\x61\x6e\x63\145\x2f\x76\x31\57\x3f\x6d\157\x64\x65\75\167\x61\x6c\x6b\151\x6e\x67\46\153\145\171\x3d" . $key; goto lxOV1; hWBY8: } goto Qdo3_; jhmPq: function addRiderCashLog($rider_id, $amount, $title = '', $type = 1, $status = 0, $order_code = '', $object_id = 0) { goto gYxc3; CU7hM: $add = Db::name("\x72\151\x64\145\x72\137\x63\x61\x73\150\x6c\x6f\x67")->insert($data); goto Rq6cd; gYxc3: $data = array("\164\x69\x74\x6c\145" => !empty($title) ? $title : '', "\162\151\x64\145\x72\137\151\144" => intval($rider_id), "\x6f\x62\x6a\x65\x63\164\x5f\151\x64" => $object_id, "\157\162\144\145\162\137\x63\x6f\x64\145" => $order_code, "\141\155\157\165\x6e\x74" => sprintf("\45\56\x32\146", $amount), "\164\171\160\x65" => intval($type), "\x73\x74\141\x74\165\163" => $status, "\141\144\144\137\x74\x69\x6d\x65" => time(), "\x75\x6e\151\141\143\151\x64" => !empty($GLOBALS["\165\156\x69\141\143\x69\144"]) ? $GLOBALS["\x75\x6e\x69\x61\x63\151\144"] : 0); goto ylEIq; ylEIq: $data["\164\151\164\x6c\x65"] == '' && ($data["\164\151\164\x6c\x65"] = $type == 0 ? "\xe5\207\x8f\xe5\xb0\x91" : "\345\242\x9e\xe5\212\xa0"); goto CU7hM; Rq6cd: return $add; goto I6fFk; I6fFk: } goto xlVwF; r5skg: function get_scope_rider($lat, $lng, $type = 0) { goto uAmB1; NOQO1: $where["\x69\x73\x5f\141\x63\143\145\x70\x74"] = 1; goto BjVDi; Ow_wM: $rider = Db::name("\162\151\x64\145\162\x5f\151\x6e\x66\157")->where($where)->where("\154\141\x74", ["\76\75", $scope["\x6d\151\156\x6c\141\164"]], ["\74\75", $scope["\x6d\x61\x78\x6c\141\x74"]], "\x61\156\x64")->where("\154\x6e\x67", ["\x3e\x3d", $scope["\155\151\x6e\154\x6e\147"]], ["\74\75", $scope["\155\x61\170\154\156\147"]], "\x61\x6e\144")->column("\162\x69\144\145\162\x5f\x69\x64\x2c\x6c\141\164\54\154\x6e\x67"); goto uGE5B; uAmB1: if (!(empty($lat) || empty($lng))) { goto HhhPj; } goto LcgS5; G8S1I: $scope = getPointDistance($lng, $lat, $distance["\166\141\154\165\x65"] * 2); goto NOQO1; e5ZSC: KQrKj: goto mdlxv; spTcz: $distance = Db::name("\163\x65\164\x74\151\x6e\x67")->where(array("\153\145\171" => "\162\151\x64\x65\x72\137\144\151\x73\164\x61\156\143\145", "\165\x6e\x69\x61\x63\151\144" => $GLOBALS["\165\x6e\x69\x61\x63\151\x64"]))->find(); goto Wuk1z; sISer: HhhPj: goto spTcz; uGE5B: if (!empty($rider)) { goto KQrKj; } goto WRfEa; Wuk1z: $distance["\166\141\154\x75\145"] = !empty($distance["\166\x61\x6c\x75\x65"]) ? intval($distance["\166\141\x6c\x75\145"]) : 10; goto G8S1I; LcgS5: return false; goto sISer; WRfEa: return array(); goto e5ZSC; mdlxv: return $rider; goto J6wUt; BjVDi: $where["\165\156\x69\x61\143\151\144"] = $GLOBALS["\x75\x6e\x69\141\x63\151\x64"]; goto Ow_wM; J6wUt: } goto EJOXd; rRhdQ: if (!function_exists("\147\x65\x74\x50\157\151\156\x74\x44\151\163\x74\141\x6e\143\145")) { function getPointDistance($lng, $lat, $distance = 1, $radius = 6371) { goto gdnOm; kiOjT: return array("\x6d\x69\x6e\154\141\164" => $lat - $dlat, "\155\x69\156\x6c\156\147" => $lng - $dlng, "\x6d\x61\170\154\141\164" => $lat + $dlat, "\155\141\x78\154\156\x67" => $lng + $dlng); goto pCv5s; hFeBz: $minLat = $lat - $dlat; goto Rbez8; gdnOm: $dlng = 2 * asin(sin($distance / (2 * $radius)) / cos(deg2rad($lat))); goto RBr09; Rbez8: $maxLat = $lat + $dlat; goto ggFI0; QeHtT: $maxLng = $lng + $dlng; goto kiOjT; x6TUd: $dlat = rad2deg($dlat); goto hFeBz; RBr09: $dlng = rad2deg($dlng); goto ZpR17; ggFI0: $minLng = $lng - $dlng; goto QeHtT; ZpR17: $dlat = $distance / $radius; goto x6TUd; pCv5s: } } goto AGo0q; j7Lwe: function is_notempty($data, $keys = array(), $except = array()) { goto PgfyZ; uc_s9: foreach ($data as $k => $v) { goto O56Xw; sFvlE: if (!(!empty($keys) && !in_array($k, $keys))) { goto xw3GE; } goto VkGlW; YPub7: goto JJLaF; goto mndC_; QjU6P: if (!empty($v)) { goto uJi7n; } goto HustG; fQiJ9: JJLaF: goto JxUvl; O56Xw: if (!in_array($k, $except)) { goto KdF3U; } goto YPub7; HustG: return $k . "\xe4\270\x8d\350\x83\275\344\xb8\xba\xe7\251\272"; goto lubZg; as1mg: xw3GE: goto QjU6P; mndC_: KdF3U: goto sFvlE; VkGlW: goto JJLaF; goto as1mg; lubZg: uJi7n: goto fQiJ9; JxUvl: } goto UL9Ii; UL9Ii: wJTwv: goto oScBC; oScBC: return true; goto UO09m; yGtDd: iBpSl: goto uc_s9; nPAzk: return "\xe6\x95\260\xe6\215\256\344\xb8\215\xe8\203\xbd\xe4\xb8\xba\347\xa9\272"; goto yGtDd; PgfyZ: if (!empty($data)) { goto iBpSl; } goto nPAzk; UO09m: } goto e_iU_; VB5lZ: function setRequest($url, $post = false, $ssl = true, $certPath = '', $keyPath = '') { goto GKl6U; VQh0K: curl_setopt($ch, CURLOPT_TIMEOUT, 30); goto HIQKi; MDdb_: curl_setopt($ch, CURLOPT_SSLCERT, $certPath); goto gevyO; LRmRc: $ch = curl_init(); goto oOJHw; Hyaqh: curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); goto OJZNK; n2iVH: return $result; goto Ra1si; CJdIX: if (!is_file($keyPath)) { goto fgSTE; } goto uIs10; Y225h: if (!(ini_get("\x6f\x70\145\156\x5f\142\x61\x73\x65\144\151\162") == '' && strtolower(ini_get("\163\x61\146\145\x5f\x6d\157\144\145")) != "\157\x6e")) { goto pPjBG; } goto HTkN3; l9v8h: curl_setopt($ch, CURLOPT_POSTFIELDS, $post); goto XnhUC; z4OZb: curl_close($ch); goto n2iVH; lzEFR: if (!function_exists("\x63\x75\162\x6c\x5f\x69\156\151\164")) { return ''; } goto LRmRc; ZjK47: curl_setopt($ch, CURLOPT_HEADER, false); goto VQh0K; uIs10: curl_setopt($ch, CURLOPT_SSLKEY, $keyPath); goto friJR; mIZIQ: pPjBG: goto Hyaqh; WeSg9: $result = curl_exec($ch); goto z4OZb; A8Nks: if (!$post) { goto vOEK5; } goto bWgue; XnhUC: vOEK5: goto ETXAA; DtprB: if (!is_file($certPath)) { goto XAsZh; } goto MDdb_; friJR: fgSTE: goto I7lFX; ETXAA: if (!($ssl && $post)) { goto vtHJK; } goto DtprB; gevyO: XAsZh: goto CJdIX; oOJHw: curl_setopt($ch, CURLOPT_URL, $url); goto ZjK47; I7lFX: vtHJK: goto WeSg9; bWgue: curl_setopt($ch, CURLOPT_POST, true); goto l9v8h; GKl6U: $result = ''; goto lzEFR; HIQKi: curl_setopt($ch, CURLOPT_MAXREDIRS, 5); goto Y225h; HTkN3: curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true); goto mIZIQ; OJZNK: curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 5); goto A8Nks; Ra1si: }